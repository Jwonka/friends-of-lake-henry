---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { photos } from "../../data/photos";

/**
 * Nonprofit-first ordering:
 * Restoration -> Donations -> Community Events -> Raffle -> Scenery
 */
const categories = ["All", "Restoration", "Donations", "Community Events", "Raffle", "Scenery"];

---

<BaseLayout title="Photos | Friends of Lake Henry">
    <div class="container" style="--maxw: 1400px;">
        <section class="card photosCard enter-block">
            <h1>Photos</h1>
            <p class="lead">
                Updates from restoration work, fundraising, community events, and life at Lake Henry.
            </p>

            <div class="filters enter-block delay-1" role="tablist" aria-label="Photo categories">
                {categories.map((cat, i) => (
                        <button
                            class={`pill filter ${i === 0 ? "active" : ""}`}
                            data-filter={cat}
                            role="tab"
                            id={`tab-${i}`}
                            aria-selected={i === 0 ? "true" : "false"}
                            tabindex={i === 0 ? 0 : -1}
                            type="button"
                        >
                            {cat}
                        </button>
                ))}
            </div>
            <p id="filterStatus" class="srOnly" role="status" aria-live="polite" aria-atomic="true"></p>
            <div class="panel galleryPanel enter-block delay-2" role="tabpanel" aria-labelledby="tab-0">
                <div class="grid enter-block delay-2" id="photoGrid">
                    {photos.map((p) => (
                        <a class="photoLink" href={`/photos/${p.slug}`} data-category={p.category}>
                            <figure class="photo">
                                <img src={p.src} alt={p.alt} loading="lazy" />
                            </figure>
                        </a>
                    ))}
                </div>
            </div>
        </section>
    </div>

    <script>
        import { initPhotoFilters } from "../../scripts/photos-filter";
        initPhotoFilters();
    </script>

    <style>
        .photosCard{margin-top: var(--section-gap); padding: 1.5rem;}
        .lead { max-width: 75ch; margin: 0 0 1.25rem; color: var(--text-strong);line-height: 1.6;}

        /* Center the tabs */
        .filters{
            display:flex;
            justify-content:center;
            gap: 0.6rem;
            flex-wrap:wrap;
            margin: 2rem 0 1rem;
        }

        .filters .pill.filter{
            font: inherit;
            font-size: 1rem;
            font-weight: 600;
            -webkit-appearance: none;
            appearance: none;
            line-height: 1.2;
        }

        .filter.active{
            background: var(--brand-tint-strong);
            border-color: var(--border-bright-strong);
            color: var(--text-on-dark);
        }

        .galleryPanel{
            padding: 1.75rem var(--gallery-space);
            background: var(--panel-bg-dense);
            border-color: rgba(255,255,255,0.14);
        }

        .grid{
            display:grid;
            gap: var(--gallery-space);
            grid-template-columns: 1fr;
        }

        .photoLink { display: block; }

        .photo{
            position: relative;
            border-radius: 16px;
            overflow:hidden;
            padding: 0;
            background: var(--glass-dark);
            backdrop-filter: blur(6px);
            border: 1px solid var(--border-strong);
            box-shadow: var(--card-shadow-strong);
            transition: transform 140ms ease, box-shadow 160ms ease, border-color 160ms ease;
            aspect-ratio: 4 / 3;
        }

        .photo img{
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;

            /* “softness” at rest without blur-shimmer */
            filter: contrast(0.98) saturate(0.98);
            transform: translateZ(0);            /* reduces shimmer */
            will-change: filter, transform;
            transition: filter 160ms ease;
        }

        /* subtle darkening overlay at rest */
        .photo::after{
            content: "";
            position: absolute;
            inset: 0;
            background: var(--overlay-soft);
            opacity: 1;
            pointer-events: none;
            transition: opacity 160ms ease;
        }

        /* hover: brighten 3–5% + slight contrast, remove overlay */
        .photo:hover img{
            filter: brightness(1.04) contrast(1.05) saturate(1.02);
        }

        .photo:hover::after{
            opacity: 0;
        }

        /* Breakpoints */
        @media (min-width: 640px){
            .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }

        @media (min-width: 980px){
            .grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }

        /* Mobile: stack category pills, full-width for easy tapping */
        @media (max-width: 520px){
            /* Give the grid more room */
            .galleryPanel{
                padding: 1rem;
            }

            .photoLink{
                width: 100%;
                margin-bottom: 0.5rem;
            }


            /* Make photos taller and more immersive */
            .photo{
                aspect-ratio: 3 / 4;
                border-radius: 18px;
                width: 100%;
                margin: 0;
            }

            .photo img{
                object-fit: cover;
                width: 100%;
            }
            .filters{
                flex-direction: column;
                align-items: stretch;
                justify-content: flex-start;
                gap: .5rem;
                margin: 1.25rem 0 1.25rem;
            }

            .filters .pill.filter{
                display: flex;
                width: 100%;
                justify-content: center;
                align-items: center;

                padding: .85rem 1rem;
                border-radius: 14px;

                background: var(--panel-bg-dense);
                backdrop-filter: none;
            }
        }
    </style>
</BaseLayout>
