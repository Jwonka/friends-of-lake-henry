---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Contact | Friends of Lake Henry">
    <div class="container">
        <section id="contact" class="contactSection card enter-block">
            <div>
                <h1>Contact</h1>
                <p>
                    Have a question, want to volunteer, or need raffle information? Send us a
                    message and we’ll get back to you.
                </p>

                <div id="status" class="status status--empty" role="status" aria-live="polite" aria-atomic="true" tabindex="-1"></div>

                <form class="form" method="post" action="/api/contact">
                    <div class="row">
                        <label  class="field">
                            <span class="labelRow">
                                Name<span class="req" aria-hidden="true">*</span>
                                <span class="srOnly">(required)</span>
                            </span>
                            <input name="name" autocomplete="name" required />
                        </label>
                        <label  class="field">
                            <span class="labelRow">
                                Email<span class="req" aria-hidden="true">*</span>
                                <span class="srOnly">(required)</span>
                            </span>
                            <input name="email" type="email" autocomplete="email" required />
                        </label>
                    </div>

                    <label  class="field">
                        <span class="labelRow">
                            Message<span class="req" aria-hidden="true">*</span>
                            <span class="srOnly">(required)</span>
                        </span>
                        <textarea name="message" rows="6" required minlength="10"></textarea>
                    </label>

                    <!-- Honeypot -->
                    <div class="hp" aria-hidden="true">
                        <label>
                            Company
                            <input type="text" name="company" tabindex="-1" autocomplete="off" />
                        </label>
                    </div>

                    <!-- Turnstile widget -->
                    <div
                        class="cf-turnstile"
                        data-sitekey={import.meta.env.PUBLIC_TURNSTILE_SITE_KEY}
                        data-size="invisible">
                    </div>

                    <button class="btn" type="submit">Send message</button>

                    <p class="fine muted">
                        By submitting, you agree we may contact you back about your request.
                    </p>
                </form>
                <script
                    src="https://challenges.cloudflare.com/turnstile/v0/api.js"
                    async
                    defer>
                </script>
            </div>
        </section>
    </div>
    <script is:inline>
        (function () {
            const el = document.getElementById("status");
            if (!el) return;

            const url = new URL(window.location.href);
            const sent = url.searchParams.get("sent");
            const err = url.searchParams.get("err");

            function show(kind, msg) {
                el.textContent = msg;
                el.classList.remove("status--empty", "status--success", "status--error");
                el.classList.add(kind === "ok" ? "status--success" : "status--error");
                el.focus();
            }

            if (sent === "1") {
                show("ok", "Thanks! We’ll be in touch shortly.");
                url.searchParams.delete("sent");
                window.history.replaceState({}, "", url.pathname + url.search);
            } else if (err) {
                show("err",
                    err === "captcha" ? "Verification failed. Please try again."
                        : err === "input" ? "Please check your details and try again."
                            : "Sorry, something went wrong. Please try again."
                );
                url.searchParams.delete("err");
                window.history.replaceState({}, "", url.pathname + url.search);
            }
        })();
    </script>
    <style>
        .contactSection{ margin-top: var(--section-gap); margin-bottom: calc(var(--section-gap) * 1.25); }
        .contactSection p {
            margin: 0 0 1.25rem;
            max-width: 65ch;
            line-height: 1.6;
            color: var(--text-strong);
        }
        p.fine { margin-top: 0.75rem; }
        p.fine.muted { color: var(--text-soft); }
        .fine { font-size: 0.95rem; margin-top: 0.75rem; }

        .form { margin-top: 1rem; display: grid; gap: 1rem; }
        .row { display: grid; gap: 1rem; grid-template-columns: 1fr; }
        label { color: var(--text); font-weight: 700; }

        input, textarea{
            padding: 0.75rem 0.85rem;
            border-radius: 12px;
            border: 1px solid var(--border-strong);
            background: rgba(0,0,0,0.12);
            color: var(--text);
        }
        textarea { resize: vertical; }
        .hp {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        .field {
            display: grid;
            gap: 0.4rem;
            color: var(--text);
            font-weight: 700;
        }

        .labelRow {
            display: inline-flex;
            align-items: baseline;
            gap: 0.25rem;
        }

        @media (min-width: 860px){
            .row{ grid-template-columns: 1fr 1fr; }
        }

        /* Mobile: make submit feel intentional */
        @media (max-width: 520px){
            .form .btn{ width: 100%; justify-content: center; }
        }
    </style>
</BaseLayout>
