---
import BaseLayout from "../../layouts/BaseLayout.astro";
export const prerender = false;
const url = Astro.url;
const err = url.searchParams.get("err");
const next = url.searchParams.get("next") ?? "/admin/";
---

<BaseLayout title="Admin Login | Friends of Lake Henry">
    <div class="container">
        <section class="card pad enter-block">
            <h1>Admin</h1>

            <div class="panel enter-block delay-1">
                <h2 class="subhead">Login</h2>

                <div id="status" class="status status--empty" role="status" aria-live="polite" aria-atomic="true" tabindex="-1"></div>

                <form class="form" method="post" action="/api/admin/login">
                    <input type="hidden" name="next" value={next} />

                    <label class="field">
                        <span class="labelRow">Username<span class="req">*</span></span>
                        <input name="username" autocomplete="username" required />
                    </label>

                    <label class="field">
                        <span class="labelRow">Password<span class="req">*</span></span>
                        <input name="password" type="password" required />
                    </label>

                    <div class="ctaRow enter-block delay-2">
                        <button class="btn" type="submit">Log in</button>
                    </div>

                    <p class="fine muted">Authorized admins only.</p>
                </form>
            </div>
        </section>
    </div>
    <script is:inline>
        (function () {
            const statusEl = document.getElementById("status");
            if (!statusEl) return;

            const url = new URL(window.location.href);
            const err = url.searchParams.get("err");

            function show(msg) {
                statusEl.textContent = msg;
                statusEl.classList.remove("status--empty");
                statusEl.classList.add("status--error");
                try { statusEl.focus(); } catch {}
            }

            if (err === "auth") show("Please log in to continue.");
            else if (err === "1") show("Invalid username or password.");
            else if (err === "server") show("Login is temporarily unavailable. Please try again later.");

            // Optional: remove err from URL after showing message (cleaner)
            if (err) {
                url.searchParams.delete("err");
                window.history.replaceState({}, "", url.pathname + url.search);
            }
        })();
    </script>
    <style>
        .pad { margin-top: var(--section-gap); }
        .subhead{ margin: 0 0 .4rem; font-size: 1.25rem; color: var(--text-strong); }
        .form { margin-top: 1rem; display: grid; gap: 1rem; }
        .field { display: grid; gap: .4rem; }
        .labelRow{ display:inline-flex; gap:.25rem; font-weight: 750; }
        .ctaRow{ display:flex; gap:.75rem; flex-wrap:wrap; margin-top:.35rem; }
        .fine{ margin: .65rem 0 0; font-size: .95rem; color: var(--text-soft); opacity: .9; }
        @media (max-width: 520px){ .form .btn{ width: 100%; justify-content: center; } }
    </style>
</BaseLayout>
